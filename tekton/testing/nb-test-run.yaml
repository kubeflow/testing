apiVersion: tekton.dev/v1alpha1
kind: PipelineRun
metadata:
  name: run-testing
  namespace: tektoncd
spec:
  params:
  - name: test-target-name
    value: manual-testinig
  - name: artifacts-gcs
    value: gs://path/to/your/gcs
  - name: junit-path
    value: artifacts/junit_manual-testing
  resources:
  - name: examples-repo
    resourceSpec:
      type: git
      params:
      - name: url
        value: https://github.com/kubeflow/examples.git
      - name: revision
        value: refs/pull/764/head
  - name: testing-repo
    resourceSpec:
      type: git
      params:
      - name: url
        value: https://github.com/kubeflow/testing.git
      - name: revision
        value: refs/pull/<pull-number>/head
  pipelineSpec:
    params:
    - name: test-target-name
      type: string
      description:
        Test targe name, used to group test results in JUNIT.
      default: manual-testing
    - name: artifacts-gcs
      type: string
      description:
        GCS bucket and directory artifacts will be uploaded to.
        Should be in the form of 'gs://'
    - name: junit-path
      type: string
      description:
        Relative path to the GCS artifacts will be uploaded to.
        Base path is artifacts-gcs so the actual GCS blob will be
        artifacts-gcs/junit-path
    - name: notebook-path
      type: string
      description:
        Testing notebook location. Should be in the form of
        {REPO_OWNER}/{REPO}/path/to/notebook.ipynb
    - name: testing-cluster-pattern
      type: string
      description:
        Cluster pattern to run the notebook test.
        Default to be from master branch.
      default: 'kf-master-(?!n\d\d)'
    resources:
    - name: examples-repo
      type: git
    - name: testing-repo
      type: git
    tasks:
            # - name: xgboost-synthetic
            #   resources:
            #     inputs:
            #     - name: examples-repo
            #       resource: examples-repo
            #     - name: kf-testing-repo
            #       resource: testing-repo
            #   taskRef:
            #     name: notebook-test
            #   params:
            #   - name: notebook-path
            #     value: $(params.notebook-path)
            #   - name: junit-path
            #     value: /workspace/outputs/$(junit-path)
            #   - name: test-target-name
            #     value: $(params.test-target-name)
            #   - name: artifacts-gcs
            #     value: $(params.artifacts-gcs)
    - name: mnist-gcp
      resources:
        inputs:
        - name: examples-repo
          resource: examples-repo
        - name: kf-testing-repo
          resource: testing-repo
      taskRef:
        name: notebook-test
      params:
      - name: notebook-path
        value: 'kubeflow/examples/mnist/mnist_gcp.ipynb'
      - name: junit-path
        value: /workspace/outputs/$(junit-path)
      - name: test-target-name
        value: $(params.test-target-name)
      - name: artifacts-gcs
        value: $(params.artifacts-gcs)

