apiVersion: batch/v1
kind: Job
metadata:
  name: snapshot-clone
  clusterName: kubeflow-testing
  namespace: kubeflow-test-infra
spec:
  template:
    spec:
      containers:
      - name: clone-worker
        image: gcr.io/kubeflow-ci/clone-worker:latest
        env:
        - name: GOOGLE_APPLICATION_CREDENTIALS
          value: /secret/gcp-credentials/key.json
        command:
        - python
        - /usr/local/bin/repo-clone-snapshot.py
        - --src_dir=/src
        volumeMounts:
        - name: gcp-credentials
          mountPath: "/secret/gcp-credentials"
          readOnly: true
      restartPolicy: "Never"
      volumes:
      - name: gcp-credentials
        secret:
          secretName: gcp-credentials
